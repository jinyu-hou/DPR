[2024-03-14 23:35:34,614][root][INFO] - CFG's local_rank=-1
[2024-03-14 23:35:34,615][root][INFO] - Env WORLD_SIZE=None
[2024-03-14 23:35:34,615][root][INFO] - Initialized host ip-172-31-67-199.ec2.internal as d.rank -1 on device=cuda, n_gpu=1, world size=1
[2024-03-14 23:35:34,615][root][INFO] - 16-bits training: False 
[2024-03-14 23:35:34,615][root][INFO] - Reading saved model from /home/ec2-user/11711-a2/DPR/dpr/downloads/checkpoint/retriever/single-adv-hn/nq/bert-base-encoder.cp
[2024-03-14 23:35:35,521][root][INFO] - model_state_dict keys odict_keys(['model_dict', 'optimizer_dict', 'scheduler_dict', 'offset', 'epoch', 'encoder_params'])
[2024-03-14 23:35:35,521][root][INFO] - CFG (after gpu  configuration):
[2024-03-14 23:35:35,528][root][INFO] - encoder:
  encoder_model_type: hf_bert
  pretrained_model_cfg: bert-base-uncased
  pretrained_file: null
  projection_dim: 0
  sequence_length: 512
  dropout: 0.1
  fix_ctx_encoder: false
  pretrained: true
datasets:
  test_qa:
    _target_: dpr.data.retriever_data.CsvQASrc
    file: /home/ec2-user/11711-a2/data/qa_csv/test_qa.csv
  cmu_qa:
    _target_: dpr.data.retriever_data.CsvQASrc
    file: /home/ec2-user/11711-a2/data/qa_csv/cmu_qa.csv
  cmu_qa_train:
    _target_: dpr.data.retriever_data.CsvQASrc
    file: /home/ec2-user/11711-a2/11711-End-to-end-NLP-System-Building/70B_qa_train.csv
  cmu_qa_dev:
    _target_: dpr.data.retriever_data.CsvQASrc
    file: /home/ec2-user/11711-a2/11711-End-to-end-NLP-System-Building/70B_qa_dev.csv
  nq_test:
    _target_: dpr.data.retriever_data.CsvQASrc
    file: data.retriever.qas.nq-test
  nq_train:
    _target_: dpr.data.retriever_data.CsvQASrc
    file: data.retriever.qas.nq-train
  nq_dev:
    _target_: dpr.data.retriever_data.CsvQASrc
    file: data.retriever.qas.nq-dev
  trivia_test:
    _target_: dpr.data.retriever_data.CsvQASrc
    file: data.retriever.qas.trivia-test
  trivia_train:
    _target_: dpr.data.retriever_data.CsvQASrc
    file: data.retriever.qas.trivia-train
  trivia_dev:
    _target_: dpr.data.retriever_data.CsvQASrc
    file: data.retriever.qas.trivia-dev
  webq_test:
    _target_: dpr.data.retriever_data.CsvQASrc
    file: data.retriever.qas.webq-test
  curatedtrec_test:
    _target_: dpr.data.retriever_data.CsvQASrc
    file: data.retriever.qas.curatedtrec-test
ctx_sources:
  dpr_wiki:
    _target_: dpr.data.retriever_data.CsvCtxSrc
    file: data.wikipedia_split.psgs_w100
    id_prefix: 'wiki:'
  cmu_lti:
    _target_: dpr.data.retriever_data.CsvCtxSrc
    file: /home/ec2-user/11711-a2/data/chunked_contexts/chunked_doc.tsv
    id_prefix: 'cmu_lti:'
  cmu_lti_papers:
    _target_: dpr.data.retriever_data.CsvCtxSrc
    file: /home/ec2-user/11711-a2/data/chunked_contexts/chunked_doc_papers.tsv
    id_prefix: 'cmu_lti:'
indexers:
  flat:
    _target_: dpr.indexer.faiss_indexers.DenseFlatIndexer
  hnsw:
    _target_: dpr.indexer.faiss_indexers.DenseHNSWFlatIndexer
  hnsw_sq:
    _target_: dpr.indexer.faiss_indexers.DenseHNSWSQIndexer
qa_dataset: cmu_qa
ctx_datatsets:
- cmu_lti
- cmu_lti_papers
encoded_ctx_files:
- /home/ec2-user/11711-a2/data/context_emb/ctx_emb_*
- /home/ec2-user/11711-a2/data/context_emb/ctx_emb_papers_*
out_file: /home/ec2-user/11711-a2/data/retriever_outputs/adv_cmuqa_retriever_output.json
match: string
n_docs: 20
validation_workers: 16
batch_size: 128
do_lower_case: true
encoder_path: null
index_path: null
kilt_out_file: null
model_file: /home/ec2-user/11711-a2/DPR/dpr/downloads/checkpoint/retriever/single-adv-hn/nq/bert-base-encoder.cp
validate_as_tables: false
rpc_retriever_cfg_file: null
rpc_index_id: null
use_l2_conversion: false
use_rpc_meta: false
rpc_meta_compressed: false
indexer: flat
special_tokens: null
local_rank: -1
global_loss_buf_sz: 150000
device: cuda
distributed_world_size: 1
distributed_port: null
no_cuda: false
n_gpu: 1
fp16: false
fp16_opt_level: O1

[2024-03-14 23:35:36,549][dpr.models.hf_models][INFO] - Initializing HF BERT Encoder. cfg_name=bert-base-uncased
[2024-03-14 23:35:36,676][dpr.models.hf_models][INFO] - Initializing HF BERT Encoder. cfg_name=bert-base-uncased
[2024-03-14 23:35:36,863][root][INFO] - Loading saved model state ...
[2024-03-14 23:35:36,932][root][INFO] - Selecting standard question encoder
[2024-03-14 23:35:37,134][root][INFO] - Encoder vector_size=768
[2024-03-14 23:35:37,134][root][INFO] - qa_dataset: cmu_qa
[2024-03-14 23:35:37,438][root][INFO] - questions len 22742
[2024-03-14 23:35:37,438][root][INFO] - questions_text len 0
[2024-03-14 23:35:37,439][root][INFO] - Local Index class <class 'dpr.indexer.faiss_indexers.DenseFlatIndexer'> 
[2024-03-14 23:35:37,439][root][INFO] - Using special token None
[2024-03-14 23:36:05,798][root][INFO] - Encoded queries 3200
[2024-03-14 23:36:33,679][root][INFO] - Encoded queries 6400
[2024-03-14 23:37:01,584][root][INFO] - Encoded queries 9600
[2024-03-14 23:37:29,505][root][INFO] - Encoded queries 12800
[2024-03-14 23:37:57,455][root][INFO] - Encoded queries 16000
[2024-03-14 23:38:25,925][root][INFO] - Encoded queries 19200
[2024-03-14 23:38:55,014][root][INFO] - Encoded queries 22400
[2024-03-14 23:38:58,143][root][INFO] - Total encoded queries tensor torch.Size([22742, 768])
[2024-03-14 23:38:58,150][root][INFO] - ctx_sources: <class 'dpr.data.retriever_data.CsvCtxSrc'>
[2024-03-14 23:38:58,151][root][INFO] - ctx_sources: <class 'dpr.data.retriever_data.CsvCtxSrc'>
[2024-03-14 23:38:58,151][root][INFO] - id_prefixes per dataset: ['cmu_lti:', 'cmu_lti:']
[2024-03-14 23:38:58,151][root][INFO] - ctx_files_patterns: ['/home/ec2-user/11711-a2/data/context_emb/ctx_emb_*', '/home/ec2-user/11711-a2/data/context_emb/ctx_emb_papers_*']
[2024-03-14 23:38:58,152][root][INFO] - Embeddings files id prefixes: ['cmu_lti:', 'cmu_lti:', 'cmu_lti:']
[2024-03-14 23:38:58,152][root][INFO] - Reading all passages data from files: ['/home/ec2-user/11711-a2/data/context_emb/ctx_emb_0', '/home/ec2-user/11711-a2/data/context_emb/ctx_emb_papers_0', '/home/ec2-user/11711-a2/data/context_emb/ctx_emb_papers_0']
[2024-03-14 23:38:58,152][root][INFO] - Reading file /home/ec2-user/11711-a2/data/context_emb/ctx_emb_0
[2024-03-14 23:38:58,169][root][INFO] - Reading file /home/ec2-user/11711-a2/data/context_emb/ctx_emb_papers_0
[2024-03-14 23:38:58,181][root][INFO] - Reading file /home/ec2-user/11711-a2/data/context_emb/ctx_emb_papers_0
[2024-03-14 23:38:58,235][root][INFO] - data indexed 15391
[2024-03-14 23:38:58,235][root][INFO] - Total data indexed 15391
[2024-03-14 23:38:58,235][root][INFO] - Data indexing completed.
[2024-03-14 23:39:02,336][root][INFO] - index search time: 4.098327 sec.
[2024-03-14 23:39:02,337][dpr.data.retriever_data][INFO] - Reading file /home/ec2-user/11711-a2/data/chunked_contexts/chunked_doc.tsv
[2024-03-14 23:39:02,483][root][INFO] - Loaded ctx data: 6291
[2024-03-14 23:39:02,483][dpr.data.retriever_data][INFO] - Reading file /home/ec2-user/11711-a2/data/chunked_contexts/chunked_doc_papers.tsv
[2024-03-14 23:39:02,505][root][INFO] - Loaded ctx data: 6291
[2024-03-14 23:39:02,505][root][INFO] - validating passages. size=6291
[2024-03-14 23:39:02,505][dpr.data.qa_validation][INFO] - all_docs size 6291
[2024-03-14 23:39:02,505][dpr.data.qa_validation][INFO] - dpr_all_documents size 6291
[2024-03-14 23:39:02,855][dpr.data.qa_validation][INFO] - Matching answers in top docs...
[2024-03-14 23:39:16,833][dpr.data.qa_validation][INFO] - Per question validation results len=22742
[2024-03-14 23:39:16,967][root][INFO] - Validation results: top k documents hits [1122, 1384, 1623, 1797, 1968, 2070, 2186, 2270, 2387, 2473, 2555, 2617, 2673, 2730, 2782, 2843, 2891, 2920, 2978, 3011]
[2024-03-14 23:39:16,967][root][INFO] - Validation results: top k documents hits accuracy [0.04933603025239645, 0.06085656494591505, 0.07136575499076599, 0.07901679711546918, 0.08653592472078094, 0.0910210183800897, 0.09612171312989183, 0.099815319672852, 0.10495998592911793, 0.10874153548500572, 0.11234719901503826, 0.11507343241579457, 0.11753583677776801, 0.12004221264620527, 0.12232873098232346, 0.12501099287661596, 0.1271216251868789, 0.12839679887432942, 0.1309471462492305, 0.13239820596253626]
[2024-03-14 23:39:21,471][root][INFO] - Saved results * scores  to /home/ec2-user/11711-a2/data/retriever_outputs/adv_cmuqa_retriever_output.json
